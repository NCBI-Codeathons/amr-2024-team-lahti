---
title: Data Summary
format: 
  revealjs:
    theme: white
    font-family: "Times New Roman"
    slideNumber: true
    scrollable: true
    
    transition: slide
---

## Data Source {.smaller}

![](images/Capture.PNG)

The data used comes from the study titled "Population-level impacts of antibiotic usage on the human gut microbiome", published in Nature Communications in 2023 by Lee et al. This large-scale study includes a total of 9,251 samples collected from various human body sites and countries.

## Aims of the study {.smaller}

-   This study explores how antibiotic use affects the abundance and diversity of resistance genes (ARGs) in the human gut.

-   Analyzing samples from healthy individuals, it finds links between national antibiotic usage and ARG prevalence, while also examining ARG transfer and resistotype patterns in the gut.

## Sample Metadata  {.smaller}

## Sample Distribution by Body Site {.smaller}

The dataset comprises samples from six major body sites, with the distribution as follows:

```{r}
library(ggplot2)
library(dplyr)
library(scales)
library(RColorBrewer)

body_site_data <- data.frame(
  Body_Site = c("Gut", "Oral Cavity", "Skin", "Airway", "Nasal Cavity", "Vagina"),
  Number_of_Samples = c(7589, 746, 380, 118, 55, 83)
)

body_site_data <- body_site_data %>%
  arrange(desc(Number_of_Samples))

body_site_data$Body_Site <- factor(body_site_data$Body_Site, 
                                   levels = body_site_data$Body_Site)

palette <- brewer.pal(n = 6, name = "Greens")

ggplot(body_site_data, aes(x = Number_of_Samples, y = Body_Site)) +
  geom_bar(stat = "identity", fill = palette[5]) +
  geom_text(aes(label = comma(Number_of_Samples)), 
            hjust = -0.1, 
            size = 4, 
            color = "black") +
  scale_x_continuous(labels = comma, 
                     expand = expansion(mult = c(0, 0.1))) +
  labs(
    title = "Sample Distribution by Body Site",
    x = "Number of Samples",
    y = "Body Site"
  ) +
  theme_minimal(base_size = 14, base_family = "Times New Roman") +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    axis.title = element_text(face = "bold"),
    axis.text = element_text(color = "black"),
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    plot.margin = margin(10, 10, 10, 10)
  ) +
  coord_cartesian(clip = "off")
```

## Sample Distribution by Country {.smaller}

The study collected samples from individuals across multiple countries.

```{r}
library(ggplot2)
library(dplyr)
library(scales)
library(ggtext)
library(RColorBrewer)

country_sample_data <- data.frame(
  Country = c("Austria", "Canada", "China", "Denmark", "France", "Germany", "Israel", 
              "Italy", "Kazakhstan", "Madagascar", "Netherlands", "Sweden", "USA", 
              "Bangladesh", "Fiji", "United Kingdom", "Tanzania"),
  Number_of_Samples = c(154, 328, 1342, 580, 157, 292, 956, 536, 172, 112, 526, 
                        600, 1431, 47, 312, 344, 67)
)

country_sample_data <- country_sample_data %>%
  arrange(desc(Number_of_Samples))

country_sample_data$Country <- factor(country_sample_data$Country, 
                                     levels = country_sample_data$Country)

palette <- brewer.pal(n = 8, name = "Blues")

ggplot(country_sample_data, aes(x = Number_of_Samples, y = Country)) +
  geom_bar(stat = "identity", fill = palette[6]) +
  geom_text(aes(label = comma(Number_of_Samples)), 
            hjust = -0.1, 
            size = 4, 
            color = "black") +
  scale_x_continuous(labels = comma, 
                     expand = expansion(mult = c(0, 0.1))) +
  labs(
    title = "Sample Distribution by Country",
    x = "Number of Samples",
    y = "Country"
  ) +
  theme_minimal(base_size = 14, base_family = "Times New Roman") +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    axis.title = element_text(face = "bold"),
    axis.text = element_text(color = "black"),
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    plot.margin = margin(10, 10, 10, 10)
  ) +
  coord_cartesian(clip = "off")
```

## Methods: Data Collection & Compilation {.smaller}

-   Manually curated ARG families from CARD database (n=752)   

-   6104 adult gut metagenome samples from 20 countries after refinning

-   curatedMetagenomeData R package for retrieving the sample metadata

-   Raw Illumina sequencing reads from NCBI or EMBL using Kingfisher-download

-   Metagenomic assemblies retrieved from [Pasolli et al.](http://segatalab.cibio.unitn.it/data/Pasolli_et_al.html)

## Data Subsetting {.smaller}

#### **Subset Criteria:**

-   **SCGs:** Selected samples with all **40 Single-Copy Genes (SCGs)** recovered (`Tier_2.Recover_all_40_SCGs`).

-   **Body Site:** Limited to **stool samples** (`BodySite`).

-   **Age Category:** Included only **adult subjects** (`AgeCategory`).

-   **Health Status:** Focused on **healthy individuals** not currently using antibiotics (`Disease` and `antibiotic_current_use_binary`).

## Sample Metadata

```{r}
library(kableExtra)
library(dplyr)
metadata_summary <- data.frame(
  Feature = c("Tier_1.Exclusion_before_analysis", "Tier_2.Recover_all_40_SCGs", 
              "Tier_3.Adult_stool_from_well_sampled_countries", 
              "Tier_4.Adult_stool_from_healthy_subjects_not_currently_on_antibiotic",
              "BodySite", "BodySubsite", "AgeCategory", "Westernized", 
              "Country", "Gender", "Disease", "antibiotic_exposure_status_descriptive", 
              "antibiotic_current_use_binary"),
  Unique_Levels_or_Summary = c("Not_excluded", "Yes", "Yes", "No, Yes", 
                               "Stool", "NA, stool, rectal_swab", 
                               "Adult, School age, Senior", "Yes, No", 
                               "ITA, SWE, FJI, MDG, CHN, DEU, KAZ, BGD, AUT, USA, CAN, FRA, DNK, ESP, NLD, MNG, PER, TZA, GBR, ISR", 
                               "F, NA, M", 
                               "Healthy, NA, RA, Cholera, CRC, Metabolic disorder, Colorectal adenoma, IBD, etc.",
                               "NA, no exposure in 6 months, no exposure at least currently, etc.", 
                               "NA, no, yes")
)

metadata_summary %>%
  kbl(caption = "Metadata Summary", 
      col.names = c("Feature", "Level")) %>%
  kable_classic(full_width = FALSE, 
                font_size = 20) %>%
  column_spec(1, bold = TRUE) %>%  
  kable_styling(latex_options = c("striped", "hold_position"), 
                position = "center", 
                full_width = FALSE) %>%
  footnote(general = "This table summarizes the categorical metadata features and their levels.")

```
